<div class="slds-page-header" style="padding: 0.3rem;">
  <div class="slds-page-header__row">
    <div class="slds-page-header__col-title">
      <div class="slds-media">
        <div *ngIf="session.recipientPhotoUrl" class="slds-media__figure">
          <span class="slds-icon_container">
            <img src="{{session.recipientPhotoUrl}}" alt="Profile picture" class="image-round">
          </span>
        </div>
        <div [hidden]="session.recipientPhotoUrl" #recipientAbbrevDiv class="slds-media__figure slds-p-around_medium">
          {{recipientAbbrev}}
        </div>
        <div class="slds-media__body slds-m-top_xx-small">
          <div>
            Your session with
          </div>
          <div class="slds-text-heading_small slds-truncate">
            <span>{{session.recipientName}}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <div *ngIf="!loading" class="slds-align_absolute-center slds-m-vertical_medium">
    <button class="slds-button slds-button_outline-brand" (click)="showNewMessagePrompt = true">New message</button>
</div> -->

<div class="slds-form-element slds-m-top_medium">
  <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right">
    <textarea #messageInput rows="2" (keyup)="autoGrowMessageInput()" placeholder="Type your message here..."
      [(ngModel)]="messageText" style="line-height: 1.2" class="slds-input slds-p-around_xx-small"></textarea>
    <button *ngIf="messageText.length > 0" (click)="createMessage()" class="slds-button slds-input__icon slds-input__icon_right"
      title="Send">
      <svg class="slds-button__icon" aria-hidden="true">
        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#send" />
      </svg>
      <span class="slds-assistive-text">Send</span>
    </button>
  </div>
</div>

<section role="log" class="slds-chat">

  <ul class="slds-chat-list">

    <li *ngIf="showSessionEmptyMsg" class="slds-chat-listitem">
      <div class="slds-chat-bookend" style="border:0px">
        <span class="slds-icon_container slds-icon-utility-chat slds-chat-icon">
          <svg class="slds-icon slds-icon_x-small slds-icon-text-default" aria-hidden="true">
            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#chat"></use>
          </svg>
        </span>
        <p>This is the start of your first session with
          <b>{{session.recipientName}}</b>. Please click <b>New message</b> above to begin.</p>
      </div>
    </li>

    <li *ngFor="let message of sessionMessages" [ngClass]="{'slds-chat-listitem':true, 'slds-chat-listitem_inbound':!message.mine, 'slds-chat-listitem_outbound':message.mine}">
      <div class="slds-chat-message">
        <div class="slds-chat-message__body">
          <div [ngClass]="{'slds-chat-message__text':true, 'slds-chat-message__text_inbound':!message.mine, 'slds-chat-message__text_outbound':message.mine}">
            <span>{{message.text}}</span>
          </div>
          <div [ngSwitch]="message.mine">
            <div class="slds-chat-message__meta">
              <span *ngSwitchCase="true">You • {{helpersService.convertToLocalDate(message.createDate) | timeAgo}}</span>
              <span *ngSwitchCase="false">{{message.senderName}} •
                {{helpersService.convertToLocalDate(message.createDate) | timeAgo}}</span>
            </div>
          </div>
        </div>
      </div>
    </li>

  </ul>
</section>

<div *ngIf="loading" class="slds-align_absolute-center slds-m-top_x-large">
  <div role="status" class="slds-spinner slds-spinner_medium slds-spinner_inline">
    <span class="slds-assistive-text">Loading</span>
    <div class="slds-spinner__dot-a"></div>
    <div class="slds-spinner__dot-b"></div>
  </div>
</div>

<div *ngIf="!loading" class="slds-align_absolute-center slds-m-vertical_small">
  <a *ngIf="!noMoreToLoad" class="slds-button" (click)="loadPreviousMessages()">Load more</a>
  <span *ngIf="noMoreToLoad">No more messages found</span>
</div>

<div *ngIf="showNewMessagePrompt">
  <section role="alertdialog" tabindex="-1" aria-labelledby="prompt-heading-id" aria-describedby="prompt-message-wrapper"
    class="slds-modal slds-fade-in-open slds-modal_prompt" aria-modal="true">
    <div class="slds-modal__container">
      <header class="slds-modal__header slds-theme_inverse" style="background-color: #005eb8">
        <button (click)="showNewMessagePrompt = !showNewMessagePrompt" class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
          title="Close">
          <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close" />
          </svg>
          <span class="slds-assistive-text">Close</span>
        </button>
        <h2 class="slds-text-heading_medium" id="prompt-heading-id">New message</h2>
      </header>
      <div class="slds-modal__content slds-p-around_medium" id="prompt-message-wrapper">
        <p>Enter your message below</p>
        <textarea [(ngModel)]="messageText" style="width:100%; height:100%" rows="5" name="messageText"></textarea>
      </div>
      <footer class="slds-modal__footer slds-theme_default">
        <button class="slds-button slds-button_neutral" (click)="showNewMessagePrompt = !showNewMessagePrompt">Cancel</button>
        <button class="slds-button slds-button_brand" (click)="createMessage()">Submit</button>
      </footer>
    </div>
  </section>
  <div class="slds-backdrop slds-backdrop_open"></div>
</div>